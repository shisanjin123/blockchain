<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>代币的转账和授权</title>
  </head>
  <body>
    <h1>代币的转账和授权</h1>
    <p>账户: <span id="account"></span></p>
    <p>余额: <span id="balance"></span></p>

    <input type="text" id="recipientAddress" placeholder="收款人地址" />
    <input type="number" id="transferAmount" placeholder="转账金额" />
    <button onclick="transfer()">转账</button>
    <br /><br />

    <input type="text" id="spenderAddress" placeholder="付款人地址" />
    <input type="number" id="approvalAmount" placeholder="授权金额" />
    <button onclick="approve()">授权</button>
    <br /><br />

    <input type="text" id="checkAddress" placeholder="查询余额的地址" />
    <button onclick="checkBalance()">查询余额</button>
    <p>查询结果: <span id="checkResult"></span></p>


    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.3/dist/web3.min.js"></script>
    <script>
      const contractAddress = "0x5d33F231E21F54B8517ba4eC57eC4fb60F088C5a";
      const contractABI = [
    {
      "inputs": [],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "owner",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "address",
          "name": "spender",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "value",
          "type": "uint256"
        }
      ],
      "name": "Approval",
      "type": "event"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "from",
          "type": "address"
        },
        {
          "indexed": true,
          "internalType": "address",
          "name": "to",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "value",
          "type": "uint256"
        }
      ],
      "name": "Transfer",
      "type": "event"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "name": "allowance",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "",
          "type": "address"
        }
      ],
      "name": "balanceOf",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "name",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "symbol",
      "outputs": [
        {
          "internalType": "string",
          "name": "",
          "type": "string"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [],
      "name": "totalSupply",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function",
      "constant": true
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_to",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "_value",
          "type": "uint256"
        }
      ],
      "name": "transfer",
      "outputs": [
        {
          "internalType": "bool",
          "name": "success",
          "type": "bool"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_spender",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "_value",
          "type": "uint256"
        }
      ],
      "name": "approve",
      "outputs": [
        {
          "internalType": "bool",
          "name": "success",
          "type": "bool"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "_from",
          "type": "address"
        },
        {
          "internalType": "address",
          "name": "_to",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "_value",
          "type": "uint256"
        }
      ],
      "name": "transferFrom",
      "outputs": [
        {
          "internalType": "bool",
          "name": "success",
          "type": "bool"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    }
  ];

      const web3 = new Web3(
        new Web3.providers.HttpProvider("http://127.0.0.1:7545")
      );
      let selectedAccount;

      web3.eth.getAccounts().then((accounts) => {
        selectedAccount = accounts[0];
        document.getElementById("account").innerText = selectedAccount;
        updateBalance(selectedAccount);
      });

      function updateBalance(account) {
        web3.eth.getBalance(account).then((balance) => {
          document.getElementById("balance").innerText =
            web3.utils.fromWei(balance, "ether") + " ETH";
        });
      }

      async function transfer() {
        const recipientAddress =
          document.getElementById("recipientAddress").value;
        const transferAmount = document.getElementById("transferAmount").value;
        const contract = new web3.eth.Contract(contractABI, contractAddress);

        await contract.methods
          .transfer(recipientAddress, transferAmount)
          .send({ from: selectedAccount });
        updateBalance(selectedAccount);
      }

      async function approve() {
        const spenderAddress = document.getElementById("spenderAddress").value;
        const approvalAmount = document.getElementById("approvalAmount").value;
        const contract = new web3.eth.Contract(contractABI, contractAddress);

        await contract.methods
          .approve(spenderAddress, approvalAmount)
          .send({ from: selectedAccount });
      }

      async function checkBalance() {
        const checkAddress = document.getElementById("checkAddress").value;
        const contract = new web3.eth.Contract(contractABI, contractAddress);

        const balance = await contract.methods.balanceOf(checkAddress).call();
        document.getElementById("checkResult").innerText = balance + " GoldDogB";
      }
    </script>
  </body>
</html>
